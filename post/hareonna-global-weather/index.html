<!doctype html>
<head><meta charset="utf-8" />
<title>Hareonna: visualize weather around the world</title>
<link href="/atom.xml" type="application/atom+xml" rel="alternate" />
<meta name="description" content="Intuitively visualize temperatures from the 13‚Äô500+ weather stations in the Global Historical Climatology Network daily (GHCNd) database, find the places with your favorite weather" />
<meta name="twitter:card" value="summary">
<meta property="og:title" content="Hareonna: visualize weather around the world" />
<meta property="og:type" content="article" />
<meta property="og:url" content="post/hareonna-global-weather/index.html" />
<meta property="og:image" content="https://fasiha.github.io/post/hareonna-global-weather/pouring-rain.jpg" />
<meta property="og:description" content="Intuitively visualize temperatures from the 13‚Äô500+ weather stations in the Global Historical Climatology Network daily (GHCNd) database, find the places with your favorite weather" />
<style>@media print {
  *,
  *:before,
  *:after {
    background: transparent !important;
    color: #000 !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }

  a,
  a:visited {
    text-decoration: underline;
  }

  a[href]:after {
    content: " (" attr(href) ")";
  }

  abbr[title]:after {
    content: " (" attr(title) ")";
  }

  a[href^="#"]:after,
  a[href^="javascript:"]:after {
    content: "";
  }

  pre,
  blockquote {
    border: 1px solid #999;
    page-break-inside: avoid;
  }

  thead {
    display: table-header-group;
  }

  tr,
  img {
    page-break-inside: avoid;
  }

  img {
    max-width: 100% !important;
  }

  p,
  h2,
  h3 {
    orphans: 3;
    widows: 3;
  }

  h2,
  h3 {
    page-break-after: avoid;
  }
  .parallax {
    background-attachment: scroll;
  }
}

pre,
code {
  font-family: Menlo, Monaco, Consolas, Inconsolata, "Andale Mono", "Fira Code", "Lucida Console", "Lucida Sans Typewriter", "Courier New", monospace;
}

pre {
  padding: .5rem;
  line-height: 1.25;
  overflow-x: scroll;
}

a,
a:visited {
  color: #3498db;
}

a:hover,
a:focus,
a:active {
  color: #2980b9;
}

.modest-no-decoration {
  text-decoration: none;
}

html {
  font-size: 12px;
}

@media screen and (min-width: 32rem) and (max-width: 48rem) {
  html {
    font-size: 15px;
  }
}

@media screen and (min-width: 48rem) {
  html {
    font-size: 16px;
  }
}

body {
  line-height: 1.85;
}

p,
.modest-p {
  font-size: 1rem;
  margin-bottom: 1.3rem;
}

h1,
.modest-h1,
h2,
.modest-h2,
h3,
.modest-h3,
h4,
.modest-h4 {
  margin: 1.414rem 0 .5rem;
  font-weight: inherit;
  line-height: 1.42;
}

h1,
.modest-h1 {
  margin-top: 0;
  font-size: 3.998rem;
}

h2,
.modest-h2 {
  font-size: 2.827rem;
}

h3,
.modest-h3 {
  font-size: 1.999rem;
}

h4,
.modest-h4 {
  font-size: 1.414rem;
}

h5,
.modest-h5 {
  font-size: 1.121rem;
}

h6,
.modest-h6 {
  font-size: .88rem;
}

small,
.modest-small {
  font-size: .707em;
}

/* https://github.com/mrmrs/fluidity */

img,
canvas,
iframe,
video,
svg,
select,
textarea {
  max-width: 100%;
}

html {
  font-size: 18px;
  max-width: 100%;
  height: 100%;
}

body {
  height: 100%;
  color: #444;
  font-family: "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
  font-weight: 300;
  margin: 0 auto;
  max-width: 48rem;
  line-height: 1.45;
  padding: 0 .25rem .25rem;
}

h1,
h2,
h3 {
  border-bottom: 2px solid #fafafa;
  margin-bottom: 1.15rem;
  padding-bottom: .5rem;
  text-align: center;
}

blockquote {
  border-left: 8px solid #fafafa;
  padding: 0.1em 1rem;
}

pre,
code {
  background-color: #fafafa;
}

figure {
  position: relative;
  text-align: center;
}
figcaption {
  color: #999;
  font-size: 0.9em;
  margin-top: 0.5em;
}

/* https://css-tricks.com/full-width-containers-limited-width-parents/ */
.full-width {
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
}
.no-top {
  margin-top: 0px;
  padding-top:0px;
}
ul.top-nav {
  padding-left: 0;
}
ul.top-nav li {
  display: inline;
  list-style-type: none;
  padding-right: 1em;
}
table{
  border-spacing: 0;
  border-collapse: collapse;
}
table th, table td{
  border: 1px solid #eee;
  padding: 6px 13px;
}
table tr:nth-child(2n) {
  background-color: #f6f8f6;
}
div.img-svg{position: relative; display: inline-block;}
div.img-svg img{display: block;max-width: 100%; height: auto;}
div.img-svg svg{position:absolute; margin:0; padding:0; top:0; left:0;}
div.img-svg svg {opacity:0}
div.img-svg svg:hover {opacity:1}
div.img-svg svg:active {opacity:1}
img.top-banner-image {
  width: auto;
  height: auto;
}</style>

</head>
<figure class="full-width no-top"><img class="top-banner-image" src="pouring-rain.jpg" width="2000" height="300"></figure>  <ul class="top-nav">
    <li><a href="/">Blog</a></li>
    <li><a href="/#contact">Contact</a></li>
    <li><a href="/atom.xml">Feed</a></li>
  </ul><h1>Hareonna: visualize weather around the world</h1><p><em>Updated on Tue, 05 Jul 2022 17:09:46 GMT, tagged with ‚Äòweather‚Äô‚Äî‚Äòmaps‚Äô‚Äî‚Äòtech‚Äô.</em></p><p><link rel="stylesheet" type="text/css" href="here.css"></p>
<p><strong><em>tl;dr: check out my app <a href="https://fasiha.github.io/hareonna">Hareonna</a>!</em></strong></p>
<p>I‚Äôve lived in a few different regions of the world and thus have appreciated various climates over the years, but it wasn‚Äôt until we moved to California‚Äôs Bay Area, by San Francisco, that I got really curious about the universe of weather on the globe‚Äîbecause the Bay weather is <em>so</em> unique. It‚Äôs not usually warm, it doesn‚Äôt rain much, but the wind is always blowing and the fog is always rolling. Where else has this kind of weather? And what other kinds of climates are there that I don‚Äôt know about?</p>
<p>Wikipedia articles on cities tend to have tabular summaries of weather broken down by month, which I have often referred to, e.g.,</p>
<figure>
<a href="./wiki-climate.png"><img src="./wiki-climate.png" alt="San Francisco climate table" /></a>
<figcaption>
<a href="https://en.wikipedia.org/wiki/San_Francisco#Climate">San Francisco climate table</a>
</figcaption>
</figure>
<p>and this often answers some questions, about <em>this</em> city, but leaves me with more question about how this city compares to <em>others</em>.</p>
<p>So with all this in mind, I began working with the <a href="https://www.ncei.noaa.gov/products/land-based-station/global-historical-climatology-network-daily">GHCNd</a> (Global Historical Climatology Network daily) database of weather station data, some of which goes back a hundred+ years. There‚Äôs <em>so</em> much you could do with this data but I want to skip to an app I wrote to visualize the temperature percentiles, <em>highs</em> and <em>lows</em>, for the ~13‚Äô500 weather stations with daily temperatures recorded for the last three years.</p>
<p>The web app is called <a href="https://fasiha.github.io/hareonna">Hareonna</a> and it lets me make plots like this (tap/click or swipe/scroll right):</p>
<div class="wide">
<figure>
<a href="./sfo-dca-cmh-my-in.png"><img src="./sfo-dca-cmh-my-in.png" alt="Five Hareonna profiles" /></a>
<figcaption>
Five Hareonna profiles
</figcaption>
</figure>
</div>
<p>(Here‚Äôs the <a href="https://fasiha.github.io/hareonna/#s:USW00023234,s:USW00013743,s:USW00014821,s:MYM00048674,s:IN022043500">direct URL for this view</a>, which also shows the above data in a tabular form.)</p>
<p>This shows the temperature profiles at five weather stations close to where I‚Äôve lived‚Äî</p>
<ul>
<li>Bay Area (SFO airport),</li>
<li>the East Coast, Washington, DC area (IAD airport),</li>
<li>the Midwest (CMH airport),</li>
<li>coastal southeast Malaysia,</li>
<li>coastal southeast India, near where I grew up.</li>
</ul>
<p>The two lines in each panel are highs and lows, with Celsius on the y-axis. The x-axis is interesting because it‚Äôs <em>percentiles</em>: a number between 0 and 100.</p>
<ul>
<li>0%ile means the all-time minimum in the three-year data window,</li>
<li>10%ile means the temperature (high and low) is lower than this 10% of the time, 36 days, 5~ish weeks. Conversely, it‚Äôs higher than this the rest of the year.</li>
<li>50%ile is the median: the temperature (high and low) is less than this half the year and more than this half the year.</li>
<li>75%ile means the temperature (high and low) is less than this nine months of the year, i.e., greater than this three months of the year.</li>
<li>100%ile means the all-time maximum in the three-year data window.</li>
</ul>
<p>So each line will always increase, but the two lines‚Äô shape tends to fall in a few patterns.</p>
<ul>
<li>The East Coast and Midwest examples above are emblematic of much of the US: mostly parallel diagonal strips.</li>
<li>A lot of the tropics is like the Malaysian and Indian examples: more horizontal than diagonal.</li>
<li>The Bay Area is another archetype: a tilted tilde/wave dash „Äú.</li>
</ul>
<p>For ease of comparison, the app puts the first temperature profile underneath the rest of them. The three horizontal lines, at 10, 20, and 30 ¬∞C, are hardcoded also to facilitate comparison across different climates.</p>
<p>Because weather is so geographic, the app has a strong map component. You can see all 13‚Äô500 weather stations on an OpenStreetMap (clustered into groups based on zoom to avoid visual and computer overload), select one, and add it to the temperature percentile plot.</p>
<p>So. Where else has weather similar to San Francisco? Well, Hareonna can answer that question, in a simplistic way, by finding the weather stations with the most similar temperature percentiles. I picked the SFO station, and clicked the ‚ÄúFind similar‚Äù button three times to get this: a map with the sixty stations most similar to SFO, indicated by lines emanating from there:</p>
<figure>
<a href="./sfo-similar-map.jpg"><img src="./sfo-similar-map.jpg" alt="Sixty weather stations most similar to SFO" /></a>
<figcaption>
Sixty weather stations most similar to SFO
</figcaption>
</figure>
<blockquote>
<p>(You can ignore the red/orange/green circles with numbers in them: those are clusters of stations, and are unrelated to the lines connecting SFO to the most similar weather stations. And I implore you to forgive me my sin of using the Web Mercator projection üí©, there are some tech notes below where I explain myself üò≠.)</p>
</blockquote>
<p>And here are the fifteen most similar compared to the SFO airport station in the temperature percentile plot (again, tap/click or swipe/scroll right):</p>
<div class="wide">
<figure>
<a href="./sfo-similar.png"><img src="./sfo-similar.png" alt="Top fifteen stations similar to SFO" /></a>
<figcaption>
Top fifteen stations similar to SFO
</figcaption>
</figure>
</div>
<p>But this map above is most intriguing! I‚Äôd previously heard anecdotes that (a) New Zealand‚Äôs Cook Strait between the two big islands, and (2) northern Portugal both had that cool, wind, fog story that San Francisco has, and there‚Äôs certainly a lot of corroboration in this! However, some surprises:</p>
<p>Southern Australia, both southwest and especially the southeast, also have strong representation.</p>
<p>The western South African coast north of Cape Town is <em>also</em> quite similar to San Francisco temperatures‚Äîbut not Cape Town itself! Here‚Äôs a look at San Francisco‚Äôs temperature percentile plot compared to four coastal South African stations (<a href="https://fasiha.github.io/hareonna/#s:USW00023234,s:SF000068712,s:SFM00068816,s:SF000068920,s:SF000288380">direct link</a>):</p>
<div class="wide">
<figure>
<a href="./sfo-south-africa.png"><img src="./sfo-south-africa.png" alt="SFO vs four South African coastal weather stations in orange circles" /></a>
<figcaption>
SFO vs four South African coastal weather stations in orange circles
</figcaption>
</figure>
</div>
<figure>
<a href="./south-africa-map.png"><img src="./south-africa-map.png" alt="Locations of the four South African stations" /></a>
<figcaption>
Locations of the four South African stations
</figcaption>
</figure>
<p>Some like Cape Columbine and Cape Agulhas are similar to San Francisco in that they have that tilted „Äú tilde shape (especially Cape Agulhas might be attractive for those who find the Bay a bit too chilly?). Cape Town and George Airport are <em>thick</em> bands in the plots: Cape Town‚Äôs lows and highs at each percentile can vary 10 to almost 15 ¬∞C!</p>
<p>And if you click on ‚ÄúFind similar‚Äù for Cape Agulhas, the southernmost highlighted weather station in the map above, you get some truly diverse locations with similar weather: Los Angeles to Sydney, Peru to the eastern Atlantic!</p>
<figure>
<a href="./cape-agulhas.jpg"><img src="./cape-agulhas.jpg" alt="Twenty weather stations most similar to Cape Agulhas in South Africa" /></a>
<figcaption>
Twenty weather stations most similar to Cape Agulhas in South Africa
</figcaption>
</figure>
<hr />
<p>Hareonna came in handy when a friend from New York City mentioned they were emigrating to Asia, and had offers in both Hong Kong and Singapore. After asking all the usual questions, I was curious about the weather change (<a href="https://fasiha.github.io/hareonna/#s:USW00094728,s:MCM00045011,s:SNM00048698">direct link</a>):</p>
<figure>
<a href="./nyc-macau-singapore.png"><img src="./nyc-macau-singapore.png" alt="New York City, Macau, Singapore" /></a>
<figcaption>
New York City, Macau, Singapore
</figcaption>
</figure>
<p>ü•µ! Macau is the closest weather station to Hong Kong in the GHCNd database, just across the Pearl River Delta‚Äîless than two hours by bus. Macau/Hong Kong at least has three months of the year where the highs are less than 25 ¬∞C. Singapore of course is thoroughly tropical: it‚Äôs coolest high in the three years of data is 25 ¬∞C! Both are of course worlds away from Manhattan‚Äôs Central Park weather station (which is quite similar to both the Ohio and Washington DC weather stations we started with), the only similarities being the overlap at the very top-right of each plot.</p>
<p>I better not get used to San Francisco‚Äôs weather, where it exceeds 25 ¬∞C just <em>five weeks</em> of the year!</p>
<hr />
<p>Something that I strongly appreciate having lived in the Bay Area for a while is how <em>local</em> weather can be. Climbing to the top of San Bruno Mountain (<a href="https://www.openstreetmap.org/node/358774522#map=13/37.6626/-122.4267">OpenStreetMap</a> link), I can <em>see</em> the chilly fog enveloping Daly City to Richmond to downtown while the East Bay is sweltering in heat. I sometimes drive half-hour south to San Mateo‚Äôs wonderful East Asian restaurants and it‚Äôs distinctly <em>hot</em> compared to San Francisco. I drive another half-hour south to San Jose‚Äôs wonderful South Indian restaurants, and it‚Äôs <em>too</em> hot.</p>
<p>Why is that?</p>
<p>KQED has a story, <a href="https://www.kqed.org/news/11827882/why-does-the-bay-area-have-so-many-microclimates">Why Does The Bay Area Have So Many Microclimates?</a>, and it touches on a few factors important to the city proper, but I think it‚Äôs straightforward to generalize the physical and marine geography.</p>
<p>Here‚Äôs the Bay‚Äôs terrain, <a href="../texshade">texture-shaded</a>, superimposed on OpenStreetMap:</p>
<figure>
<div class="img-svg">
<a href="./bay-300.jpg"> <img src="./bay-300-small.jpg" alt="The Bay Area: map with terrain; press/hover for annotations, click for high-resolution" /> <?xml version="1.0"?> <svg width="566" height="566" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <!-- Created with SVG-edit - https://github.com/SVG-Edit/svgedit-->
<title>
Bay Area annotations
</title>
<g class="layer">
<title>
Layer 1
</title>
<rect fill="#000000" fill-opacity="0" height="181" id="svg_2" stroke="#ffffff" stroke-linejoin="round" stroke-opacity="0.5" stroke-width="4" transform="matrix(1 0 0 1 0 0)" width="182" x="19" y="110"/> <text fill="#ffffff" font-family="Serif" font-size="24" id="svg_3" stroke="#000000" stroke-dasharray="null" stroke-linecap="null" stroke-linejoin="null" stroke-width="0" text-anchor="middle" x="110" xml:space="preserve" y="137">Full Pacific wind</text> <ellipse cx="333.54" cy="446.31" fill="#000000" fill-opacity="0" id="svg_4" rx="72" ry="228.25" stroke="#ffffff" stroke-linecap="null" stroke-linejoin="round" stroke-opacity="0.5" stroke-width="4" transform="matrix(1 0 0 1 0 0) rotate(-51.397 333.537 446.305)"/> <text fill="#ffffff" font-family="Serif" font-size="24" id="svg_6" stroke="#000000" stroke-dasharray="null" stroke-linecap="null" stroke-linejoin="null" stroke-width="0" text-anchor="middle" transform="matrix(1 0 0 1 0 0) rotate(39.7376 365 426)" x="365" xml:space="preserve" y="434">Airflow blocked by Coastal Ranges</text> </g> </svg> </a>
</div>
<figcaption>
The Bay Area: map with terrain; press/hover for annotations, click for high-resolution
</figcaption>
</figure>
<p>Long-press or hover over the above map to see my annotations but even without them, you may be able to see why South San Francisco, Daly City, and San Francisco proper all might be chilly, windy, and foggy, while areas south like San Mateo and definity by Palo Alto are warmer and drier: the Coastal Ranges that begin just south of Daly City put some ten kilometers of mountains between the Pacific and the cities along the Bay.</p>
<p>Here‚Äôs a <a href="./bay-300.jpg">high-res 300 dpi render</a>, which I hope you‚Äôll take a look at: both are made from USGS‚Äô delicious <a href="https://www.sciencebase.gov/catalog/item/581d2938e4b08da350d61140">NED ‚Öë‚Ä≥ topo-bathymetry</a> of the Bay Area‚Äîone-ninth of an arcsecond is a pixel every <em>three</em> meters. Which is stunning: the widely used SRTM terrain dataset is a pixel every <em>thirty</em> meters (and is the data used by my <a href="../texshade">Texture-Shaded Globe</a>).</p>
<blockquote>
<p>(My fellow GIS lovers: QGIS didn‚Äôt export PGW files for these layout renders, so bear with me: x min/max -122.543¬∞ to -121.938, y min/max 37.333¬∞ to 37.938¬∞.)</p>
</blockquote>
<hr />
<p><a href="https://fasiha.github.io/hareonna">Hareonna</a> is very raw and young, and there are so many directions it could go in. What‚Äôs next? In no particular order:</p>
<ul>
<li>I‚Äôd love to be able to see a heatmap of areas of the globe that are more or less similar to a particular station.</li>
<li>I‚Äôd absolutely love to see precipitation data, which is crucially important in California.</li>
<li>Everything in the app is pre-computed (all the percentiles and weather station locations). But I‚Äôd like to be able to fetch the daily data from NOAA‚Äôs servers in the app to show a line graph of temperatures.</li>
<li>I‚Äôd love to find a way to deal with the missing information in many of these.</li>
<li>I‚Äôd like to integrate other data sources: GHCNd doesn‚Äôt have a single weather station in Taiwan. You can <a href="https://www.ncei.noaa.gov/maps/">check</a>; and, I‚Äôve <a href="https://twitter.com/gratidue/status/1539320097189163009">asked for help</a> (<a href="https://nitter.eu/gratidue/status/1539320097189163009">Nitter URL</a>).</li>
<li>More data in general. My phone‚Äôs weather app can show five cities‚Äô real-time temperatures between San Francisco International airport and Redwood City: why are those not in GHCNd? Is that data proprietary?</li>
</ul>
<p>I am quite pleased with the visualization technique created for Hareonna‚Äîthe percentile highs and lows, and I‚Äôd be most gratified if it became a popular way to roughly show annual temperature profiles. I‚Äôm also curious how it can be improved.</p>
<hr />
<p>A few tech notes follow.</p>
<p>At the insistence of NoScript-loving friends on social media, I finally investigated React.js‚Äô server-side rendering (SSR), via Next.js, and built Hareonna with that. Verdict: 10/10, will build every app in the foreseeable future with Next. But Next and pnpm and even React are really power-tools: I had to use some fairly intricate JavaScript magic to get these to play nicely with all parts of the app, so I‚Äôm a bit wary of recommending it to beginner web developers. Specifically, it was not straightforward to integrate with Leaflet, which is the library that does all the mapping.</p>
<p>Leaflet: ‚úÖ. Yes, Web Mercator is üí©, and in an ideal world, I‚Äôd have used D3‚Äôs <a href="https://observablehq.com/@d3/world-tour">orthographic projection</a> or <a href="https://sandcastle.cesium.com/">Cesium.js</a>‚Äô WebGL globe, but Leaflet‚Äôs API and ecosystem, along with OpenStreetMap, made it straightforward to go from idea in my head to app in my hands, and that cannot be overstated. In Joseph Gentle‚Äôs breaking down of coders into <a href="https://josephg.com/blog/3-tribes/">three tribes</a>, makers, hackers, and poets, I very much see myself first and foremost as a <strong>maker</strong>, but with a weakness of absent-mindedly accidentally writing code I didn‚Äôt want to write. Thus, I hugely value Jamie Brandon‚Äôs memorable phrasing:</p>
<blockquote>
<p><em>If you have a mountain of shit to move, how much time should you spend looking for a bigger shovel?</em> There's no obviously correct answer‚Äîit must depend on the size of the mountain, the availability of large shovels, how quickly you have to move it etc. <em>But the answer absolutely cannot be 100% of your time.</em> <strong>At some point you have to shovel some shit.</strong> ‚ÄîJamie Brandon, <a href="https://www.scattered-thoughts.net/writing/things-unlearned/">Things Unlearned</a></p>
</blockquote>
<p>Leaflet is a solid grimoire for the code magician: Sarah Drasner recently <a href="https://twitter.com/sarah_edo/status/1544518772702121984">tweeted</a> (<a href="https://nitter.eu/sarah_edo/status/1544518772702121984">Nitter alternative</a>):</p>
<blockquote>
<p>I will never get over the magic of programming: 3 days ago I had an idea, and now I have a useful, functioning app.</p>
</blockquote>
<p>Hareonna also uses <a href="https://nominatim.openstreetmap.org/ui/search.html">OpenStreetMap‚Äôs Nominatim</a> API for converting user-provided locations to lat/lon coordinates to zoom into. I love OpenStreetMap‚Äîwhat a monumental achievement!</p>
<p>Finally, I‚Äôd like to note that GHCNd is a good candidate for developers looking for code katas in data munging with a large web-based database. If someone‚Äôs interested in using GHCNd as part of their interview, or just in formalizing a sequence of katas based on the database, <a href="/#contact">get in touch</a>!</p>
<hr />
<p>(Banner: crop from <a href="https://flic.kr/p/2kJTcaM">David Yu‚Äôs Flickr</a>: ‚ÄúPouring Rain‚Äù, San Francisco, 2021)</p>
<p>
<small>Previous: <a href="/post/galef-calibration/">Announcing: Devastate‚Äîcalibrating uncertainty via trivia</a><br></small>
</p>
